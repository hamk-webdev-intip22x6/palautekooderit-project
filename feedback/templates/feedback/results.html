{% extends 'base.html' %}
{% block title %}Results{% endblock %}

{% block content %}

    <h1>Feedback Results</h1>

    <div class="selectionBox">
        <!-- Dropdown list of topics -->
        <h2>Select a Topic</h2>
        <select id="topicSelect">
            <option selected>None</option>

            {% for topic in topics %}
                <option value="{{ topic.id }}">{{ topic.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="resultsBox">
        <div class="container">
            <div class="row">
                <div class="col" id="ratings">
                    <h3>Ratings</h3>
                    <ol>
                        <li>⭐ (<span id="ratings1">0</span>)</li>
                        <li>⭐⭐ (<span id="ratings2">0</span>)</li>
                        <li>⭐⭐⭐ (<span id="ratings3">0</span>)</li>
                        <li>⭐⭐⭐⭐ (<span id="ratings4">0</span>)</li>
                        <li>⭐⭐⭐⭐⭐ (<span id="ratings5">0</span>)</li>
                    </ol>
                </div>
                <div class="col" id="rating_graphics">
                    Rating Graphics
                </div>
            </div>
            <div class="row">
                <div class="col" id="good_feedback">
                    Good
                </div>
                <div class="col" id="bad_feedback">
                    Bad
                </div>
            </div>
            <div class="row">
                <div class="col" id="ideas_feedback">
                    Ideas
                </div>
                <div class="col">
                    Placeholder
                </div>
            </div>
        </div>
    </div>

    <script>
        let topicSelect = document.getElementById('topicSelect');
        let ratings = document.getElementById('ratings');
        let ratingGraphics = document.getElementById('rating_graphics');
        let goodFeedback = document.getElementById('good_feedback');
        let badFeedback = document.getElementById('bad_feedback');
        let ideasFeedback = document.getElementById('ideas_feedback');
        
        topicSelect.addEventListener('change', function() {
            fetch(`/feedback/get-feedbacks/${this.value}`)
            .then(res => res.json())
            .then(feedbacks => {
                let ratingCounts = [0, 0, 0, 0, 0];

                for (let i = 0; i < feedbacks.length; i++) {
                    let feedback = feedbacks[i];
                    let fields = feedback["fields"]
                    ratingCounts[fields["rating"] - 1] += 1;
                }

                document.getElementById('ratings1').innerHTML = ratingCounts[0];
                document.getElementById('ratings2').innerHTML = ratingCounts[1];
                document.getElementById('ratings3').innerHTML = ratingCounts[2];
                document.getElementById('ratings4').innerHTML = ratingCounts[3];
                document.getElementById('ratings5').innerHTML = ratingCounts[4];
            });
        });
    </script>

{% endblock %}